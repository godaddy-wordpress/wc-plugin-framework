{"version":3,"sources":["frontend/sv-wc-payment-gateway-my-payment-methods.coffee"],"names":["jQuery","$","window","SV_WC_Payment_Methods_Handler_v5_12_4","args","replace_method_column","bind","remove_duplicate_default_marks","edit_method","save_method","cancel_edit","id","slug","i18n","ajax_url","ajax_nonce","on","event","row","currentTarget","parents","find","length","confirm","delete_ays","preventDefault","hasClass","each","index","element","titleColumn","remove","children","html","button","hide","show","addClass","text","cancel_button","removeClass","enable_editing_ui","data","block_ui","next","action","nonce","token_id","val","serialize","post","done","response","success","title","siblings","edit_button","disable_editing_ui","display_error","fail","jqXHR","textStatus","error","always","unblock_ui","parent","block","message","overlayCSS","background","opacity","unblock","columns","console","save_error","insertAfter","delay","slideUp","document","body","trigger","call"],"mappings":"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","file":"sv-wc-payment-gateway-my-payment-methods.js","sourceRoot":"../js","sourcesContent":["(function() {\n  /*\n   WooCommerce SkyVerge Payment Gateway My Payment Methods CoffeeScript\n   Version 5.1.0\n\n   Copyright (c) 2014-2024, SkyVerge, Inc.\n   Licensed under the GNU General Public License v3.0\n   http://www.gnu.org/licenses/gpl-3.0.html\n  */\n  jQuery(function($) {\n    \"use strict\";\n    // The My Payment Methods handler.\n\n    // @since 5.1.0\n    window.SV_WC_Payment_Methods_Handler_v5_12_4 = class SV_WC_Payment_Methods_Handler_v5_12_4 {\n      // Constructs the class.\n\n      // @since 5.1.0\n\n      // @param [Object] args, with the properties:\n      //     id:         [String] plugin ID\n      //     slug:       [String] plugin slug or dasherized ID\n      //     i18n:       [Object] localized text strings\n      //     ajax_url:   [String] URL for AJAX requests\n      //     ajax_nonce: [String] nonce for AJAX requests\n      constructor(args) {\n        // Replace Method column content with Title column content, for FW tokens.\n\n        // @since 5.8.0\n        this.replace_method_column = this.replace_method_column.bind(this);\n        // Removes duplicate \"Default\" marks.\n\n        // They are already hidden using CSS, but should also be removed for accessibility.\n\n        // @since 5.8.0\n        this.remove_duplicate_default_marks = this.remove_duplicate_default_marks.bind(this);\n        // Edits a payment method.\n\n        // @since 5.1.0\n\n        // @param [Object] event jQuery event object\n        this.edit_method = this.edit_method.bind(this);\n        // Saves a payment method.\n\n        // @since 5.1.0\n\n        // @param [Object] event jQuery event object\n        this.save_method = this.save_method.bind(this);\n        // Cancels/stop editing a payment method.\n\n        // @since 5.1.0\n\n        // @param [Object] event jQuery event object\n        this.cancel_edit = this.cancel_edit.bind(this);\n        this.id = args.id;\n        this.slug = args.slug;\n        this.i18n = args.i18n;\n        this.ajax_url = args.ajax_url;\n        this.ajax_nonce = args.ajax_nonce;\n        // replace the \"Method\" column content for FW tokens\n        this.replace_method_column();\n        // remove duplicate \"Default\" marks\n        this.remove_duplicate_default_marks();\n        // handle the edit action\n        $(\".woocommerce-MyAccount-paymentMethods\").on('click', \".woocommerce-PaymentMethod--actions .button.edit\", (event) => {\n          return this.edit_method(event);\n        });\n        // handle the save action\n        $(\".woocommerce-MyAccount-paymentMethods\").on('click', \".woocommerce-PaymentMethod--actions .button.save\", (event) => {\n          return this.save_method(event);\n        });\n        // handle the cancel action\n        $(\".woocommerce-MyAccount-paymentMethods\").on('click', \".woocommerce-PaymentMethod--actions .cancel-edit\", (event) => {\n          return this.cancel_edit(event);\n        });\n        // handle the delete action\n        $(\".woocommerce-MyAccount-paymentMethods\").on('click', \".woocommerce-PaymentMethod--actions .button.delete\", (event) => {\n          var button, row;\n          button = $(event.currentTarget);\n          row = button.parents('tr');\n          // check if the method belongs to this plugin\n          if (row.find(`input[name=plugin-id][value=${this.slug}]`).length === 0) {\n            return;\n          }\n          if (!confirm(this.i18n.delete_ays)) {\n            return event.preventDefault();\n          }\n        });\n        // don't follow the Add Payment Method button URL if it's disabled\n        $('.button[href*=\"add-payment-method\"]').on('click', event(function() {\n          if ($(this).hasClass('disabled')) {\n            return event.preventDefault();\n          }\n        }));\n      }\n\n      replace_method_column() {\n        return $('.woocommerce-MyAccount-paymentMethods').find('tr').each((index, element) => {\n          var titleColumn;\n          // check if the method belongs to this plugin\n          if ($(element).find(`input[name=plugin-id][value=${this.slug}]`).length === 0) {\n            return;\n          }\n          // delete the Title header\n          $(element).find('th.woocommerce-PaymentMethod--title').remove();\n          titleColumn = $(element).find('td.woocommerce-PaymentMethod--title');\n          // Title column is not empty, this is a FW token\n          if (titleColumn.children().length > 0) {\n            // replace Method column\n            $(element).find('td.woocommerce-PaymentMethod--method').html(titleColumn.html());\n          }\n          // delete Title column\n          return $(element).find('td.woocommerce-PaymentMethod--title').remove();\n        });\n      }\n\n      remove_duplicate_default_marks() {\n        return $('.woocommerce-MyAccount-paymentMethods').find('tr').each((index, element) => {\n          return $(element).find('td.woocommerce-PaymentMethod--default').find('mark.default:not(:first-child)').remove();\n        });\n      }\n\n      edit_method(event) {\n        var button, row;\n        event.preventDefault();\n        button = $(event.currentTarget);\n        row = button.parents('tr');\n        // check if the method belongs to this plugin\n        if (row.find(`input[name=plugin-id][value=${this.slug}]`).length === 0) {\n          return;\n        }\n        row.find('div.view').hide();\n        row.find('div.edit').show();\n        row.addClass('editing');\n        // change the Edit button to \"Cancel\"\n        button.text(this.i18n.cancel_button).removeClass('edit').addClass('cancel-edit').removeClass('button');\n        return this.enable_editing_ui();\n      }\n\n      save_method(event) {\n        var button, data, row;\n        event.preventDefault();\n        button = $(event.currentTarget);\n        row = button.parents('tr');\n        // check if the method belongs to this plugin\n        if (row.find(`input[name=plugin-id][value=${this.slug}]`).length === 0) {\n          return;\n        }\n        this.block_ui();\n        // remove any previous errors\n        row.next('.error').remove();\n        data = {\n          action: `wc_${this.id}_save_payment_method`,\n          nonce: this.ajax_nonce,\n          token_id: row.find('input[name=token-id]').val(),\n          data: row.find('input[name]').serialize()\n        };\n        return $.post(this.ajax_url, data).done((response) => {\n          if (!response.success) {\n            return this.display_error(row, response.data);\n          }\n          if (response.data.title != null) {\n            row.find('.woocommerce-PaymentMethod--method').html(response.data.title);\n          }\n          if (response.data.nonce != null) {\n            this.ajax_nonce = response.data.nonce;\n          }\n          // change the \"Cancel\" button back to \"Edit\"\n          button.siblings('.cancel-edit').removeClass('cancel-edit').addClass('edit').text(this.i18n.edit_button).addClass('button');\n          row.removeClass('editing');\n          return this.disable_editing_ui();\n        }).fail((jqXHR, textStatus, error) => {\n          return this.display_error(row, error);\n        }).always(() => {\n          return this.unblock_ui();\n        });\n      }\n\n      cancel_edit(event) {\n        var button, row;\n        event.preventDefault();\n        button = $(event.currentTarget);\n        row = button.parents('tr');\n        // check if the method belongs to this plugin\n        if (row.find(`input[name=plugin-id][value=${this.slug}]`).length === 0) {\n          return;\n        }\n        row.find('div.view').show();\n        row.find('div.edit').hide();\n        row.removeClass('editing');\n        // change the \"Cancel\" button back to \"Edit\"\n        button.removeClass('cancel-edit').addClass('edit').text(this.i18n.edit_button).addClass('button');\n        return this.disable_editing_ui();\n      }\n\n      // Sets the page UI to the \"editing\" state.\n\n      // This brings proper focus to the method being edited and prevents\n      // other available buttons/actions until the editing is finished or cancelled.\n\n      // @since 5.1.1\n      enable_editing_ui() {\n        // set the methods table as 'editing'\n        $(\".woocommerce-MyAccount-paymentMethods\").addClass('editing');\n        // disable the Add Payment Method button\n        return $('.button[href*=\"add-payment-method\"]').addClass('disabled');\n      }\n\n      // Sets the page UI back to the default state.\n\n      // @since 5.1.1\n      disable_editing_ui() {\n        // removes the methods table's \"editing\" status\n        $(\".woocommerce-MyAccount-paymentMethods\").removeClass('editing');\n        // re-enable the Add Payment Method button\n        return $('.button[href*=\"add-payment-method\"]').removeClass('disabled');\n      }\n\n      // Blocks the payment methods table UI.\n\n      // @since 5.1.0\n      block_ui() {\n        return $(\".woocommerce-MyAccount-paymentMethods\").parent('div').block({\n          message: null,\n          overlayCSS: {\n            background: '#fff',\n            opacity: 0.6\n          }\n        });\n      }\n\n      // Unblocks the payment methods table UI.\n\n      // @since 5.1.0\n      unblock_ui() {\n        return $(\".woocommerce-MyAccount-paymentMethods\").parent('div').unblock();\n      }\n\n      // Displays an error message to the user.\n\n      // @since 5.1.0\n\n      // @param [Object] row payment method table row\n      // @param [String] error raw error message\n      // @param [String] message user error message\n      display_error(row, error, message = '') {\n        var columns;\n        console.error(error);\n        if (!message) {\n          message = this.i18n.save_error;\n        }\n        columns = $(\".woocommerce-MyAccount-paymentMethods thead tr th\").length;\n        return $('<tr class=\"error\"><td colspan=\"' + columns + '\">' + message + '</td></tr>').insertAfter(row).find('td').delay(8000).slideUp(200);\n      }\n\n    };\n    // dispatch loaded event\n    return $(document.body).trigger('sv_wc_payment_methods_handler_v5_12_4_loaded');\n  });\n\n}).call(this);\n"]}