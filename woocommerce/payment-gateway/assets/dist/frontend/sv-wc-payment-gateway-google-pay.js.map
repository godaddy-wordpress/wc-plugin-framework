{"version":3,"sources":["frontend/sv-wc-payment-gateway-google-pay.js"],"names":["jQuery","$","window","SV_WC_Google_Pay_Handler_v5_12_0","params","_classCallCheck","plugin_id","merchant_id","merchant_name","gateway_id","environment","gateway_id_dasherized","ajax_url","recalculate_totals_nonce","process_nonce","button_style","card_types","available_countries","currency_code","needs_shipping","generic_error","gatewayID","merchantID","merchantName","ajaxURL","recalculateTotalsNonce","processNonce","buttonStyle","availableCountries","currencyCode","needsShipping","genericError","product_id","productID","allowedCardNetworks","baseRequest","apiVersion","apiVersionMinor","tokenizationSpecification","type","parameters","baseCardPaymentMethod","allowedAuthMethods","billingAddressRequired","billingAddressParameters","format","phoneNumberRequired","cardPaymentMethod","Object","assign","paymentsClient","_createClass","key","value","allowedPaymentMethods","resolve","_this","getGoogleTransactionInfo","transactionInfo","paymentDataRequest","merchantInfo","merchantId","emailRequired","callbackIntents","shippingAddressRequired","shippingAddressParameters","getGoogleShippingAddressParameters","shippingOptionRequired","_this2","args","paymentDataCallbacks","onPaymentAuthorized","paymentData","onPaymentDataChanged","google","payments","api","PaymentsClient","_this3","blockUI","Promise","reject","processPayment","err","transactionState","error","intent","message","reason","unblockUI","intermediatePaymentData","_this4","shippingAddress","shippingOptionData","chosenShippingMethod","callbackTrigger","id","getUpdatedTotals","paymentDataRequestUpdate","newShippingOptionParameters","shippingOptions","length","getGoogleUnserviceableAddressError","failPayment","_this5","data","action","concat","post","response","success","JSON","parse","shippingMethod","_this6","allowedCountryCodes","_this7","button","getGooglePaymentsClient","createButton","onClick","event","onGooglePaymentButtonClicked","buttonColor","buttonSizeMode","document","getElementById","appendChild","_this8","getGooglePaymentDataRequest","totalPriceStatus","prefetchPaymentData","_this9","nonce","stringify","location","redirect","_this10","preventDefault","loadPaymentData","initProductPage","initCartPage","initCheckoutPage","initGooglePay","_this11","isReadyToPay","getGoogleIsReadyToPayRequest","then","result","addGooglePayButton","prefetchGooglePaymentData","catch","uiElement","_this12","parents","body","on","console","renderErrors","errors","remove","prepend","join","removeClass","unblock","animate","scrollTop","offset","top","block","overlayCSS","background","opacity","trigger"],"mappings":"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","file":"sv-wc-payment-gateway-google-pay.js","sourceRoot":"../js","sourcesContent":["jQuery( function( $ ) {\n\n\t\"use strict\"\n\n\t/**\n\t * Google Pay handler.\n\t *\n\t * @since 5.10.0\n\t *\n\t * @type {SV_WC_Google_Pay_Handler_v5_12_0} object\n\t */\n\twindow.SV_WC_Google_Pay_Handler_v5_12_0 = class SV_WC_Google_Pay_Handler_v5_12_0 {\n\n\t\t/**\n\t\t * Handler constructor.\n\t\t *\n\t\t * @since 5.10.0\n\t\t *\n\t\t * @param {Object} params The plugin ID\n\t\t * @param {string} params.plugin_id The plugin ID\n\t\t * @param {string} params.merchant_id The merchant ID\n\t\t * @param {string} params.merchant_name The site name\n\t\t * @param {string} params.gateway_id The gateway ID\n\t\t * @param {string} params.gateway_id_dasherized The gateway ID dasherized\n\t\t * @param {string} params.environment The gateway environment (PRODUCTION or TEST)\n\t\t * @param {string} params.ajax_url The AJAX URL\n\t\t * @param {string} params.recalculate_totals_nonce Nonce for the recalculate_totals AJAX action\n\t\t * @param {string} params.process_nonce Nonce for the process AJAX action\n\t\t * @param {string} params.button_style The button style\n\t\t * @param {string[]} params.card_types The supported card types\n\t\t * @param {string[]} params.available_countries Array of two-letter country codes the gateway is available for\n\t\t * @param {string[]} params.currency_code WC configured currency\n\t\t * @param {boolean} params.needs_shipping Whether or not the cart or product needs shipping\n\t\t * @param {string} params.generic_error The generic error message\n\t\t * @param {string} params.product_id The product ID if we are on a Product page\n\t\t */\n\t\tconstructor( params ) {\n\n\t\t\tlet {\n\t\t\t\tplugin_id,\n\t\t\t\tmerchant_id,\n\t\t\t\tmerchant_name,\n\t\t\t\tgateway_id,\n\t\t\t\tgateway_id_dasherized,\n\t\t\t\tenvironment,\n\t\t\t\tajax_url,\n\t\t\t\trecalculate_totals_nonce,\n\t\t\t\tprocess_nonce,\n\t\t\t\tbutton_style,\n\t\t\t\tcard_types,\n\t\t\t\tavailable_countries,\n\t\t\t\tcurrency_code,\n\t\t\t\tneeds_shipping,\n\t\t\t\tgeneric_error\n\t\t\t} = params;\n\n\t\t\tthis.gatewayID              = gateway_id;\n\t\t\tthis.merchantID             = merchant_id;\n\t\t\tthis.merchantName           = merchant_name;\n\t\t\tthis.environment            = environment;\n\t\t\tthis.ajaxURL                = ajax_url;\n\t\t\tthis.recalculateTotalsNonce = recalculate_totals_nonce;\n\t\t\tthis.processNonce           = process_nonce;\n\t\t\tthis.buttonStyle            = button_style;\n\t\t\tthis.availableCountries     = available_countries;\n\t\t\tthis.currencyCode           = currency_code;\n\t\t\tthis.needsShipping          = needs_shipping;\n\t\t\tthis.genericError           = generic_error;\n\n\t\t\tif ( params.product_id ) {\n\t\t\t\tthis.productID = params.product_id;\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Card networks supported by your site and your gateway\n\t\t\t *\n\t\t\t * @see {@link https://developers.google.com/pay/api/web/reference/request-objects#CardParameters|CardParameters}\n\t\t\t */\n\t\t\tconst allowedCardNetworks = card_types;\n\n\t\t\t/**\n\t\t\t * Define the version of the Google Pay API referenced when creating your configuration\n\t\t\t *\n\t\t\t * @see {@link https://developers.google.com/pay/api/web/reference/request-objects#PaymentDataRequest|apiVersion in PaymentDataRequest}\n\t\t\t */\n\t\t\tthis.baseRequest = {\n\t\t\t\tapiVersion: 2,\n\t\t\t\tapiVersionMinor: 0\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * Card authentication methods supported by your site and your gateway\n\t\t\t *\n\t\t\t * @see {@link https://developers.google.com/pay/api/web/reference/request-objects#CardParameters|CardParameters}\n\t\t\t *\n\t\t\t * @todo confirm your processor supports Android device tokens for your supported card networks\n\t\t\t */\n\t\t\tconst allowedCardAuthMethods = [ 'PAN_ONLY', 'CRYPTOGRAM_3DS' ];\n\n\t\t\t/**\n\t\t\t * Identify your gateway and your site's gateway merchant identifier\n\t\t\t *\n\t\t\t * The Google Pay API response will return an encrypted payment method capable\n\t\t\t * of being charged by a supported gateway after payer authorization\n\t\t\t *\n\t\t\t * @see {@link https://developers.google.com/pay/api/web/reference/request-objects#gateway|PaymentMethodTokenizationSpecification}\n\t\t\t */\n\t\t\tconst tokenizationSpecification = {\n\t\t\t\ttype: 'PAYMENT_GATEWAY',\n\t\t\t\tparameters: {\n\t\t\t\t\t'gateway': plugin_id,\n\t\t\t\t\t'gatewayMerchantId': this.merchantID\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * Describe your site's support for the CARD payment method and its required fields\n\t\t\t *\n\t\t\t * @see {@link https://developers.google.com/pay/api/web/reference/request-objects#CardParameters|CardParameters}\n\t\t\t */\n\t\t\tthis.baseCardPaymentMethod = {\n\t\t\t\ttype: 'CARD',\n\t\t\t\tparameters: {\n\t\t\t\t\tallowedAuthMethods: allowedCardAuthMethods,\n\t\t\t\t\tallowedCardNetworks: allowedCardNetworks,\n\t\t\t\t\tbillingAddressRequired: true,\n\t\t\t\t\tbillingAddressParameters: {\n\t\t\t\t\t\tformat: 'FULL',\n\t\t\t\t\t\tphoneNumberRequired: true\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * Describe your site's support for the CARD payment method including optional fields\n\t\t\t *\n\t\t\t * @see {@link https://developers.google.com/pay/api/web/reference/request-objects#CardParameters|CardParameters}\n\t\t\t */\n\t\t\tthis.cardPaymentMethod = Object.assign(\n\t\t\t\t{},\n\t\t\t\tthis.baseCardPaymentMethod,\n\t\t\t\t{\n\t\t\t\t\ttokenizationSpecification: tokenizationSpecification\n\t\t\t\t}\n\t\t\t);\n\n\t\t\t/**\n\t\t\t * An initialized google.payments.api.PaymentsClient object or null if not yet set\n\t\t\t *\n\t\t\t * @see {@link getGooglePaymentsClient}\n\t\t\t */\n\t\t\tthis.paymentsClient = null;\n\t\t}\n\n\t\t/**\n\t\t * Configure your site's support for payment methods supported by the Google Pay\n\t\t * API.\n\t\t *\n\t\t * Each member of allowedPaymentMethods should contain only the required fields,\n\t\t * allowing reuse of this base request when determining a viewer's ability\n\t\t * to pay and later requesting a supported payment method\n\t\t *\n\t\t * @returns {object} Google Pay API version, payment methods supported by the site\n\t\t */\n\t\tgetGoogleIsReadyToPayRequest() {\n\n\t\t\treturn Object.assign(\n\t\t\t\t{},\n\t\t\t\tthis.baseRequest,\n\t\t\t\t{\n\t\t\t\t\tallowedPaymentMethods: [ this.baseCardPaymentMethod ]\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\t/**\n\t\t * Configure support for the Google Pay API\n\t\t *\n\t\t * @see {@link https://developers.google.com/pay/api/web/reference/request-objects#PaymentDataRequest|PaymentDataRequest}\n\t\t *\n\t\t * @param {function} resolve callback\n\t\t * @returns {object} PaymentDataRequest fields\n\t\t */\n\t\tgetGooglePaymentDataRequest( resolve ) {\n\n\t\t\treturn this.getGoogleTransactionInfo( ( transactionInfo ) => {\n\n\t\t\t\tconst paymentDataRequest = Object.assign( {}, this.baseRequest );\n\t\t\t\tpaymentDataRequest.allowedPaymentMethods = [ this.cardPaymentMethod ];\n\t\t\t\tpaymentDataRequest.transactionInfo = transactionInfo;\n\t\t\t\tpaymentDataRequest.merchantInfo = {\n\t\t\t\t\tmerchantId: this.merchantID,\n\t\t\t\t\tmerchantName: this.merchantName\n\t\t\t\t};\n\n\t\t\t\tpaymentDataRequest.emailRequired = true;\n\t\t\t\tpaymentDataRequest.callbackIntents = [ 'PAYMENT_AUTHORIZATION' ];\n\n\t\t\t\tif ( this.needsShipping ) {\n\t\t\t\t\tpaymentDataRequest.callbackIntents = [ 'SHIPPING_ADDRESS', 'SHIPPING_OPTION', 'PAYMENT_AUTHORIZATION' ];\n\t\t\t\t\tpaymentDataRequest.shippingAddressRequired = true;\n\t\t\t\t\tpaymentDataRequest.shippingAddressParameters = this.getGoogleShippingAddressParameters();\n\t\t\t\t\tpaymentDataRequest.shippingOptionRequired = true;\n\t\t\t\t}\n\n\t\t\t\tresolve( paymentDataRequest );\n\t\t\t} );\n\t\t}\n\n\t\t/**\n\t\t * Return an active PaymentsClient or initialize\n\t\t *\n\t\t * @see {@link https://developers.google.com/pay/api/web/reference/client#PaymentsClient|PaymentsClient constructor}\n\t\t * @returns {google.payments.api.PaymentsClient} Google Pay API client\n\t\t */\n\t\tgetGooglePaymentsClient() {\n\t\t\tif ( this.paymentsClient === null ) {\n\t\t\t\tlet args = {\n\t\t\t\t\tenvironment: this.environment,\n\t\t\t\t\tmerchantInfo: {\n\t\t\t\t\t\tmerchantName: this.merchantName,\n\t\t\t\t\t\tmerchantId: this.merchantID\n\t\t\t\t\t},\n\t\t\t\t\tpaymentDataCallbacks: {\n\t\t\t\t\t\tonPaymentAuthorized: ( paymentData ) => this.onPaymentAuthorized( paymentData ),\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tif ( this.needsShipping ) {\n\t\t\t\t\targs.paymentDataCallbacks.onPaymentDataChanged = ( paymentData ) => this.onPaymentDataChanged( paymentData );\n\t\t\t\t}\n\n\t\t\t\tthis.paymentsClient = new google.payments.api.PaymentsClient( args );\n\t\t\t}\n\t\t\treturn this.paymentsClient;\n\t\t}\n\n\t\t/**\n\t\t * Handles payment authorization callback intent.\n\t\t *\n\t\t * @param {object} paymentData response from Google Pay API after a payer approves payment.\n\t\t * @see {@link https://developers.google.com/pay/api/web/reference/response-objects#PaymentData|PaymentData object reference}\n\t\t *\n\t\t * @returns Promise<{object}> Promise object to complete or fail the transaction.\n\t\t */\n\t\tonPaymentAuthorized( paymentData ) {\n\n\t\t\tthis.blockUI();\n\n\t\t\treturn new Promise( (resolve, reject) => {\n\n\t\t\t\t// handle the response\n\t\t\t\ttry {\n\t\t\t\t\tthis.processPayment( paymentData, resolve );\n\t\t\t\t}\tcatch( err ) {\n\t\t\t\t\treject( {\n\t\t\t\t\t\ttransactionState: 'ERROR',\n\t\t\t\t\t\terror: {\n\t\t\t\t\t\t\tintent: 'PAYMENT_AUTHORIZATION',\n\t\t\t\t\t\t\tmessage: 'Payment could not be processed',\n\t\t\t\t\t\t\treason: 'PAYMENT_DATA_INVALID'\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\t}\n\n\t\t\t\tthis.unblockUI();\n\t\t\t} );\n\t\t}\n\n\t\t/**\n\t\t * Handles dynamic buy flow shipping address and shipping options callback intents.\n\t\t *\n\t\t * @param {object} intermediatePaymentData response from Google Pay API a shipping address or shipping option is selected in the payment sheet.\n\t\t * @see {@link https://developers.google.com/pay/api/web/reference/response-objects#IntermediatePaymentData|IntermediatePaymentData object reference}\n\t\t *\n\t\t * @see {@link https://developers.google.com/pay/api/web/reference/response-objects#PaymentDataRequestUpdate|PaymentDataRequestUpdate}\n\t\t * @returns Promise<{object}> Promise of PaymentDataRequestUpdate object to update the payment sheet.\n\t\t */\n\t\tonPaymentDataChanged( intermediatePaymentData ) {\n\n\t\t\tthis.blockUI();\n\n\t\t\treturn new Promise(( resolve, reject ) => {\n\n\t\t\t\ttry {\n\t\t\t\t\tlet shippingAddress = intermediatePaymentData.shippingAddress;\n\t\t\t\t\tlet shippingOptionData = intermediatePaymentData.shippingOptionData;\n\t\t\t\t\tlet chosenShippingMethod = '';\n\n\t\t\t\t\tif ( intermediatePaymentData.callbackTrigger == 'SHIPPING_OPTION' ) {\n\t\t\t\t\t\tchosenShippingMethod = shippingOptionData.id;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.getUpdatedTotals( shippingAddress, chosenShippingMethod, ( paymentDataRequestUpdate ) => {\n\n\t\t\t\t\t\tif ( paymentDataRequestUpdate.newShippingOptionParameters.shippingOptions.length == 0 ) {\n\t\t\t\t\t\t\tpaymentDataRequestUpdate = {\n\t\t\t\t\t\t\t\terror: this.getGoogleUnserviceableAddressError()\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresolve( paymentDataRequestUpdate );\n\t\t\t\t\t} );\n\n\t\t\t\t}\tcatch( err ) {\n\t\t\t\t\tthis.failPayment( 'Could not load updated totals or process payment data request update. ' + err );\n\t\t\t\t}\n\n\t\t\t\tthis.unblockUI();\n\t\t\t} );\n\t\t}\n\n\t\t/**\n\t\t * Provide Google Pay API with a payment amount, currency, and amount status\n\t\t *\n\t\t * @see {@link https://developers.google.com/pay/api/web/reference/request-objects#TransactionInfo|TransactionInfo}\n\t\t *\n\t\t * @param {function} resolve callback\n\t\t * @returns {object} transaction info, suitable for use as transactionInfo property of PaymentDataRequest\n\t\t */\n\t\tgetGoogleTransactionInfo( resolve ) {\n\n\t\t\t// get transaction info from cart\n\t\t\tconst data = {\n\t\t\t\taction: `wc_${this.gatewayID}_google_pay_get_transaction_info`,\n\t\t\t}\n\n\t\t\tif ( this.productID ) {\n\t\t\t\tdata.productID = this.productID;\n\t\t\t}\n\n\t\t\t$.post( this.ajaxURL, data, ( response ) => {\n\n\t\t\t\tif ( response.success ) {\n\t\t\t\t\tresolve( JSON.parse( response.data ) )\n\t\t\t\t} else {\n\t\t\t\t\tthis.failPayment( 'Could not build transaction info. ' + response.data.message );\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\t/**\n\t\t * Get updated totals and shipping options via AJAX for use in the PaymentDataRequest\n\t\t *\n\t\t * @see {@link https://developers.google.com/pay/api/web/reference/response-objects#PaymentDataRequestUpdate|PaymentDataRequestUpdate}\n\t\t *\n\t\t * @param {object} shippingAddress shipping address\n\t\t * @param {object} shippingMethod chosen shipping method\n\t\t * @param {function} resolve callback\n\t\t */\n\t\tgetUpdatedTotals( shippingAddress, shippingMethod, resolve ) {\n\n\t\t\tconst data = {\n\t\t\t\taction: `wc_${this.gatewayID}_google_pay_recalculate_totals`,\n\t\t\t\t'nonce': this.recalculateTotalsNonce,\n\t\t\t\tshippingAddress,\n\t\t\t\tshippingMethod\n\t\t\t}\n\n\t\t\tif ( this.productID ) {\n\t\t\t\tdata.productID = this.productID;\n\t\t\t}\n\n\t\t\t$.post( this.ajaxURL, data, ( response ) => {\n\n\t\t\t\tif ( response.success ) {\n\t\t\t\t\tresolve( JSON.parse( response.data ) )\n\t\t\t\t} else {\n\t\t\t\t\tthis.failPayment( 'Could not recalculate totals. ' + response.data.message );\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\t/**\n\t\t * Provide Google Pay API with shipping address parameters when using dynamic buy flow.\n\t\t *\n\t\t * @see {@link https://developers.google.com/pay/api/web/reference/request-objects#ShippingAddressParameters|ShippingAddressParameters}\n\t\t * @returns {object} shipping address details, suitable for use as shippingAddressParameters property of PaymentDataRequest\n\t\t */\n\t\tgetGoogleShippingAddressParameters() {\n\n\t\t\treturn {\n\t\t\t\tallowedCountryCodes: this.availableCountries\n\t\t\t};\n\t\t}\n\n\t\t/**\n\t\t * Provide Google Pay API with a payment data error.\n\t\t *\n\t\t * @see {@link https://developers.google.com/pay/api/web/reference/response-objects#PaymentDataError|PaymentDataError}\n\t\t * @returns {object} payment data error, suitable for use as error property of PaymentDataRequestUpdate\n\t\t */\n\t\tgetGoogleUnserviceableAddressError() {\n\t\t\treturn {\n\t\t\t\treason: 'SHIPPING_ADDRESS_UNSERVICEABLE',\n\t\t\t\tmessage: 'Cannot ship to the selected address',\n\t\t\t\tintent: 'SHIPPING_ADDRESS'\n\t\t\t};\n\t\t}\n\n\t\t/**\n\t\t * Add a Google Pay purchase button alongside an existing checkout button\n\t\t *\n\t\t * @see {@link https://developers.google.com/pay/api/web/reference/request-objects#ButtonOptions|Button options}\n\t\t * @see {@link https://developers.google.com/pay/api/web/guides/brand-guidelines|Google Pay brand guidelines}\n\t\t */\n\t\taddGooglePayButton() {\n\n\t\t\tconst paymentsClient = this.getGooglePaymentsClient();\n\t\t\tconst button = paymentsClient.createButton( {\n\t\t\t\tonClick: ( event ) => this.onGooglePaymentButtonClicked( event ),\n\t\t\t\tbuttonColor: this.buttonStyle,\n\t\t\t\tbuttonSizeMode: 'fill'\n\t\t\t} );\n\t\t\tdocument.getElementById( 'sv-wc-google-pay-button-container' ).appendChild( button );\n\t\t}\n\n\t\t/**\n\t\t * Prefetch payment data to improve performance\n\t\t *\n\t\t * @see {@link https://developers.google.com/pay/api/web/reference/client#prefetchPaymentData|prefetchPaymentData()}\n\t\t */\n\t\tprefetchGooglePaymentData() {\n\n\t\t\tthis.getGooglePaymentDataRequest( ( paymentDataRequest ) => {\n\n\t\t\t\t// transactionInfo must be set but does not affect cache\n\t\t\t\tpaymentDataRequest.transactionInfo = {\n\t\t\t\t\ttotalPriceStatus: 'NOT_CURRENTLY_KNOWN',\n\t\t\t\t\tcurrencyCode: this.currencyCode\n\t\t\t\t};\n\t\t\t\tconst paymentsClient = this.getGooglePaymentsClient();\n\t\t\t\tpaymentsClient.prefetchPaymentData( paymentDataRequest );\n\t\t\t} );\n\t\t}\n\n\t\t/**\n\t\t * Process payment data returned by the Google Pay API\n\t\t *\n\t\t * @see {@link https://developers.google.com/pay/api/web/reference/response-objects#PaymentData|PaymentData object reference}\n\t\t *\n\t\t * @param {object} paymentData response from Google Pay API after user approves payment\n\t\t * @param {function} resolve callback\n\t\t */\n\t\tprocessPayment( paymentData, resolve ) {\n\n\t\t\t// pass payment token to your gateway to process payment\n\t\t\tconst data = {\n\t\t\t\taction: `wc_${this.gatewayID}_google_pay_process_payment`,\n\t\t\t\tnonce: this.processNonce,\n\t\t\t\tpaymentData: JSON.stringify( paymentData ),\n\t\t\t}\n\n\t\t\tif ( this.productID && ! this.needsShipping ) {\n\t\t\t\tdata.productID = this.productID;\n\t\t\t}\n\n\t\t\treturn $.post( this.ajaxURL, data, ( response ) => {\n\t\t\t\tif ( response.success ) {\n\t\t\t\t\tresolve( {\n\t\t\t\t\t\ttransactionState: 'SUCCESS'\n\t\t\t\t\t} );\n\t\t\t\t\twindow.location = response.data.redirect;\n\t\t\t\t} else {\n\t\t\t\t\tresolve( {\n\t\t\t\t\t\ttransactionState: 'ERROR',\n\t\t\t\t\t\terror: {\n\t\t\t\t\t\t\tintent: 'SHIPPING_ADDRESS',\n\t\t\t\t\t\t\tmessage: 'Invalid data',\n\t\t\t\t\t\t\treason: 'PAYMENT_DATA_INVALID'\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\t\tthis.failPayment( 'Payment could not be processed. ' + response.data.message );\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\t/**\n\t\t * Show Google Pay payment sheet when Google Pay payment button is clicked\n\t\t */\n\t\tonGooglePaymentButtonClicked( event ) {\n\n\t\t\tevent.preventDefault();\n\n\t\t\tthis.blockUI();\n\n\t\t\tthis.getGooglePaymentDataRequest( ( paymentDataRequest ) => {\n\n\t\t\t\tconst paymentsClient = this.getGooglePaymentsClient();\n\t\t\t\ttry {\n\t\t\t\t\tpaymentsClient.loadPaymentData( paymentDataRequest );\n\t\t\t\t} catch ( err ) {\n\t\t\t\t\tthis.failPayment( 'Could not load payment data. ' + err );\n\t\t\t\t}\n\n\t\t\t\tthis.unblockUI();\n\t\t\t} );\n\t\t}\n\n\t\t/**\n\t\t * Initialize Google PaymentsClient after Google-hosted JavaScript has loaded\n\t\t *\n\t\t * Display a Google Pay payment button after confirmation of the viewer's\n\t\t * ability to pay.\n\t\t */\n\t\tinit() {\n\n\t\t\t// initialize for the various pages\n\t\t\tif ( $( 'form.cart' ).length ) {\n\t\t\t\tthis.initProductPage();\n\t\t\t} else if ( $( 'form.woocommerce-cart-form' ).length ) {\n\t\t\t\tthis.initCartPage();\n\t\t\t} else if ( $( 'form.woocommerce-checkout' ).length) {\n\t\t\t\tthis.initCheckoutPage()\n\t\t\t} else {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.initGooglePay();\n\t\t}\n\n\t\t/**\n\t\t * Initializes Google Pay.\n\t\t */\n\t\tinitGooglePay() {\n\n\t\t\tconst paymentsClient = this.getGooglePaymentsClient();\n\t\t\tpaymentsClient.isReadyToPay( this.getGoogleIsReadyToPayRequest() )\n\t\t\t\t.then( ( response ) => {\n\t\t\t\t\tif ( response.result ) {\n\t\t\t\t\t\tthis.addGooglePayButton();\n\t\t\t\t\t\t// prefetch payment data to improve performance\n\t\t\t\t\t\tthis.prefetchGooglePaymentData();\n\t\t\t\t\t}\n\t\t\t\t} )\n\t\t\t\t.catch( ( err ) => {\n\t\t\t\t\tthis.failPayment( 'Google Pay is not ready. ' + err );\n\t\t\t\t} );\n\t\t}\n\n\t\t/**\n\t\t * Initializes the product page.\n\t\t */\n\t\tinitProductPage() {\n\t\t\tthis.uiElement = $( 'form.cart' );\n\t\t}\n\n\t\t/**\n\t\t * Initializes the cart page.\n\t\t */\n\t\tinitCartPage() {\n\t\t\tthis.uiElement = $( 'form.woocommerce-cart-form' ).parents( 'div.woocommerce' );\n\n\t\t\t// re-init if the cart totals are updated\n\t\t\t$( document.body ).on( 'updated_cart_totals', () => {\n\t\t\t\tthis.initGooglePay();\n\t\t\t} );\n\t\t}\n\n\t\t/**\n\t\t * Initializes the checkout page.\n\t\t */\n\t\tinitCheckoutPage() {\n\t\t\tthis.uiElement = $( 'form.woocommerce-checkout' );\n\t\t}\n\n\t\t/**\n\t\t * Fails the purchase based on the gateway result.\n\t\t */\n\t\tfailPayment( error ) {\n\n\t\t\tconsole.error( '[Google Pay] ' + error );\n\n\t\t\tthis.unblockUI();\n\n\t\t\tthis.renderErrors( [ this.genericError ] );\n\t\t}\n\n\t\t/**\n\t\t * Renders any new errors and bring them into the viewport.\n \t\t */\n\t\trenderErrors( errors ) {\n\n\t\t\t// hide and remove any previous errors\n\t\t\t$( '.woocommerce-error, .woocommerce-message' ).remove();\n\n\t\t\t// add errors\n\t\t\tthis.uiElement.prepend( '<ul class=\"woocommerce-error\"><li>' + errors.join( '</li><li>' ) + '</li></ul>' );\n\n\t\t\t// unblock UI\n\t\t\tthis.uiElement.removeClass( 'processing' ).unblock();\n\n\t\t\t// scroll to top\n\t\t\t$( 'html, body' ).animate( { scrollTop: this.uiElement.offset().top - 100 }, 1000 );\n\t\t}\n\n\t\t/**\n\t\t * Blocks the payment form UI.\n\t\t */\n\t\tblockUI() {\n\t\t\tthis.uiElement.block( { message: null, overlayCSS: { background: '#fff', opacity: 0.6 } } );\n\t\t}\n\n\t\t/**\n\t\t * Unblocks the payment form UI.\n\t\t */\n\t\tunblockUI() {\n\t\t\tthis.uiElement.unblock();\n\t\t}\n\t}\n\n\t$( document.body ).trigger( 'sv_wc_google_pay_handler_v5_12_0_loaded' );\n\n} );\n"]}