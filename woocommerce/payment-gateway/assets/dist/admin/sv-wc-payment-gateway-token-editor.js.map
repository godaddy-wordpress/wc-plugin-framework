{"version":3,"sources":["admin/sv-wc-payment-gateway-token-editor.coffee"],"names":[],"mappings":"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","file":"sv-wc-payment-gateway-token-editor.js","sourceRoot":"../js","sourcesContent":["###\n WooCommerce SkyVerge Payment Gateway Framework Token Editor CoffeeScript\n Version 4.3.0-beta\n\n Copyright (c) 2016, SkyVerge, Inc.\n Licensed under the GNU General Public License v3.0\n http://www.gnu.org/licenses/gpl-3.0.html\n###\njQuery ( $ ) ->\n\t\"use strict\"\n\n\twc_payment_gateway_token_editor = window.wc_payment_gateway_token_editor ? {}\n\n\n\t$( '.sv_wc_payment_gateway_token_editor' ).each () ->\n\n\t\ttokens = $( this ).find( 'tr.token' )\n\n\t\tif ( tokens.length is 0 )\n\t\t\t$( this ).find( 'tr.no-tokens' ).show()\n\t\telse\n\t\t\t$( this ).find( 'tr.no-tokens' ).hide()\n\n\n\t# Remove a token\n\t$( '.sv_wc_payment_gateway_token_editor' ).on 'click', '.button[data-action=\"remove\"]', ( e ) ->\n\n\t\te.preventDefault()\n\n\t\treturn unless confirm( wc_payment_gateway_token_editor.actions.remove_token.ays )\n\n\t\teditor = $( this ).closest( 'table' )\n\n\t\teditor.block( message: null, overlayCSS: background: '#fff',opacity: 0.6 )\n\n\t\teditor.find( '.error' ).remove()\n\n\t\trow = $( this ).closest( 'tr' )\n\n\t\t# if this is an unsaved token, just remove the row\n\t\tif row.hasClass( 'new-token' )\n\t\t\teditor.unblock()\n\t\t\treturn row.remove()\n\n\t\tdata =\n\t\t\taction:   'wc_payment_gateway_' + editor.data( 'gateway-id' ) + '_admin_remove_payment_token'\n\t\t\tuser_id:  $( this ).data( 'user-id' )\n\t\t\ttoken_id: $( this ).data( 'token-id' )\n\t\t\tsecurity: wc_payment_gateway_token_editor.actions.remove_token.nonce\n\n\t\t$.post wc_payment_gateway_token_editor.ajax_url, data\n\n\t\t\t.done ( response ) =>\n\n\t\t\t\treturn handleError( editor, response.data ) unless response.success\n\n\t\t\t\t$( row ).remove()\n\n\t\t\t\t# no more tokens? Display a message\n\t\t\t\tif ( editor.find( 'tr.token' ).length is 0 )\n\t\t\t\t\teditor.find( 'tr.no-tokens' ).show()\n\n\t\t\t.fail ( jqXHR, textStatus, error ) =>\n\n\t\t\t\thandleError( editor, textStatus + ': ' + error )\n\n\t\t\t.always =>\n\n\t\t\t\teditor.unblock()\n\n\n\n\n\t# Add a new (blank) token\n\t$( 'table.sv_wc_payment_gateway_token_editor' ).on 'click', '.button[data-action=\"add-new\"]', ( e ) ->\n\n\t\te.preventDefault()\n\n\t\teditor = $( this ).closest( 'table' )\n\n\t\teditor.block( message: null, overlayCSS: background: '#fff',opacity: 0.6 )\n\n\t\tbody  = editor.find( 'tbody.tokens' )\n\t\tcount = body.find( 'tr.token' ).length\n\n\t\tdata =\n\t\t\taction:   'wc_payment_gateway_' + editor.data( 'gateway-id' ) + '_admin_get_blank_payment_token'\n\t\t\tindex:    count + 1\n\t\t\tsecurity: wc_payment_gateway_token_editor.actions.add_token.nonce\n\n\t\t$.post wc_payment_gateway_token_editor.ajax_url, data, ( response ) ->\n\n\t\t\tif response.success is true then body.append( response.data )\n\n\t\t\teditor.find( 'tr.no-tokens' ).hide()\n\n\t\t\teditor.unblock()\n\n\n\t# Refresh the tokens\n\t$( 'table.sv_wc_payment_gateway_token_editor' ).on 'click', '.button[data-action=\"refresh\"]', ( e ) ->\n\n\t\te.preventDefault()\n\n\t\teditor = $( this ).closest( 'table' )\n\n\t\teditor.block( message: null, overlayCSS: background: '#fff',opacity: 0.6 )\n\n\t\teditor.find( '.error' ).remove()\n\n\t\tbody  = editor.find( 'tbody.tokens' )\n\t\tcount = body.find( 'tr.token' ).length\n\n\t\tdata =\n\t\t\taction:   'wc_payment_gateway_' + editor.data( 'gateway-id' ) + '_admin_refresh_payment_tokens'\n\t\t\tuser_id:  $( this ).data( 'user-id' )\n\t\t\tsecurity: wc_payment_gateway_token_editor.actions.refresh.nonce\n\n\t\t$.post wc_payment_gateway_token_editor.ajax_url, data\n\n\t\t\t.done ( response ) =>\n\n\t\t\t\treturn handleError( editor, response.data ) unless response.success\n\n\t\t\t\tif response.data?\n\t\t\t\t\teditor.find( 'tr.no-tokens' ).hide()\n\t\t\t\t\tbody.html( response.data )\n\t\t\t\telse\n\t\t\t\t\tbody.empty()\n\t\t\t\t\teditor.find( 'tr.no-tokens' ).show()\n\n\t\t\t.fail ( jqXHR, textStatus, error ) =>\n\n\t\t\t\thandleError( editor, textStatus + ': ' + error )\n\n\t\t\t.always =>\n\n\t\t\t\teditor.unblock()\n\n\t# Save the tokens\n\t$( 'table.sv_wc_payment_gateway_token_editor' ).on 'click', '.sv-wc-payment-gateway-token-editor-action-button[data-action=\"save\"]', ( e ) ->\n\n\t\teditor      = $( this ).closest( 'table' )\n\t\tactions_row = editor.find( 'tfoot th' )\n\n\t\teditor.block( message: null, overlayCSS: background: '#fff',opacity: 0.6 )\n\n\t\tactions_row.find( '.error, .success' ).remove();\n\n\t\t# Validate the input data\n\n\t\tinputs  = editor.find( 'tbody.tokens tr.token input[type=\"text\"]' )\n\t\tfocused = false\n\n\t\tinputs.each ( index ) ->\n\n\t\t\t$( this ).removeClass( 'error' )\n\n\t\t\tvalue    = $( this ).val()\n\t\t\trequired = $( this ).prop( 'required' )\n\t\t\tpattern  = $( this ).attr( 'pattern' )\n\n\t\t\treturn unless required or value\n\n\t\t\tif ( ! value.match( pattern ) or ( required and ! value ) )\n\n\t\t\t\te.preventDefault()\n\n\t\t\t\t$( this ).addClass( 'error' )\n\n\t\t\t\tif ( ! focused )\n\t\t\t\t\tactions_row.prepend( '<span class=\"error\">' + wc_payment_gateway_token_editor.actions.save.error + '</span>' )\n\t\t\t\t\t$( this ).focus()\n\t\t\t\t\tfocused = true\n\n\t\t\t\teditor.unblock()\n\n\n\t# Handles any AJAX errors.\n\t#\n\t# @since 5.1.0\n\thandleError = ( editor, error, message = '' ) ->\n\n\t\tconsole.error error\n\n\t\tmessage = wc_payment_gateway_token_editor.i18n.general_error unless message\n\n\t\teditor.find( 'th.actions' ).prepend( '<span class=\"error\">' + message + '</span>' )\n"]}