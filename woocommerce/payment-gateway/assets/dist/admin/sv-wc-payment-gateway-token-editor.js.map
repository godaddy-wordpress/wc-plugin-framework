{"version":3,"sources":["admin/sv-wc-payment-gateway-token-editor.coffee"],"names":["jQuery","$","handleError","ref","wc_payment_gateway_token_editor","window","each","tokens","find","length","show","hide","on","e","data","editor","row","preventDefault","confirm","actions","remove_token","ays","closest","block","message","overlayCSS","background","opacity","remove","hasClass","unblock","action","user_id","token_id","security","nonce","post","ajax_url","done","response","success","fail","jqXHR","textStatus","error","always","body","count","index","add_token","append","refresh","html","empty","actions_row","focused","inputs","pattern","required","value","removeClass","val","prop","attr","match","addClass","prepend","save","focus","console","i18n","general_error","call"],"mappings":"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","file":"sv-wc-payment-gateway-token-editor.js","sourceRoot":"../js","sourcesContent":["(function() {\n  /*\n   WooCommerce SkyVerge Payment Gateway Framework Token Editor CoffeeScript\n   Version 4.3.0\n\n   Copyright (c) 2016, SkyVerge, Inc.\n   Licensed under the GNU General Public License v3.0\n   http://www.gnu.org/licenses/gpl-3.0.html\n  */\n  jQuery(function($) {\n    \"use strict\";\n    var handleError, ref, wc_payment_gateway_token_editor;\n    wc_payment_gateway_token_editor = (ref = window.wc_payment_gateway_token_editor) != null ? ref : {};\n    $('.sv_wc_payment_gateway_token_editor').each(function() {\n      var tokens;\n      tokens = $(this).find('tr.token');\n      if (tokens.length === 0) {\n        return $(this).find('tr.no-tokens').show();\n      } else {\n        return $(this).find('tr.no-tokens').hide();\n      }\n    });\n    // Remove a token\n    $('.sv_wc_payment_gateway_token_editor').on('click', '.button[data-action=\"remove\"]', function(e) {\n      var data, editor, row;\n      e.preventDefault();\n      if (!confirm(wc_payment_gateway_token_editor.actions.remove_token.ays)) {\n        return;\n      }\n      editor = $(this).closest('table');\n      editor.block({\n        message: null,\n        overlayCSS: {\n          background: '#fff',\n          opacity: 0.6\n        }\n      });\n      editor.find('.error').remove();\n      row = $(this).closest('tr');\n      // if this is an unsaved token, just remove the row\n      if (row.hasClass('new-token')) {\n        editor.unblock();\n        return row.remove();\n      }\n      data = {\n        action: 'wc_payment_gateway_' + editor.data('gateway-id') + '_admin_remove_payment_token',\n        user_id: $(this).data('user-id'),\n        token_id: $(this).data('token-id'),\n        security: wc_payment_gateway_token_editor.actions.remove_token.nonce\n      };\n      return $.post(wc_payment_gateway_token_editor.ajax_url, data).done((response) => {\n        if (!response.success) {\n          return handleError(editor, response.data);\n        }\n        $(row).remove();\n        // no more tokens? Display a message\n        if (editor.find('tr.token').length === 0) {\n          return editor.find('tr.no-tokens').show();\n        }\n      }).fail((jqXHR, textStatus, error) => {\n        return handleError(editor, textStatus + ': ' + error);\n      }).always(() => {\n        return editor.unblock();\n      });\n    });\n    // Add a new (blank) token\n    $('table.sv_wc_payment_gateway_token_editor').on('click', '.button[data-action=\"add-new\"]', function(e) {\n      var body, count, data, editor;\n      e.preventDefault();\n      editor = $(this).closest('table');\n      editor.block({\n        message: null,\n        overlayCSS: {\n          background: '#fff',\n          opacity: 0.6\n        }\n      });\n      body = editor.find('tbody.tokens');\n      count = body.find('tr.token').length;\n      data = {\n        action: 'wc_payment_gateway_' + editor.data('gateway-id') + '_admin_get_blank_payment_token',\n        index: count + 1,\n        security: wc_payment_gateway_token_editor.actions.add_token.nonce\n      };\n      return $.post(wc_payment_gateway_token_editor.ajax_url, data, function(response) {\n        if (response.success === true) {\n          body.append(response.data);\n        }\n        editor.find('tr.no-tokens').hide();\n        return editor.unblock();\n      });\n    });\n    // Refresh the tokens\n    $('table.sv_wc_payment_gateway_token_editor').on('click', '.button[data-action=\"refresh\"]', function(e) {\n      var body, count, data, editor;\n      e.preventDefault();\n      editor = $(this).closest('table');\n      editor.block({\n        message: null,\n        overlayCSS: {\n          background: '#fff',\n          opacity: 0.6\n        }\n      });\n      editor.find('.error').remove();\n      body = editor.find('tbody.tokens');\n      count = body.find('tr.token').length;\n      data = {\n        action: 'wc_payment_gateway_' + editor.data('gateway-id') + '_admin_refresh_payment_tokens',\n        user_id: $(this).data('user-id'),\n        security: wc_payment_gateway_token_editor.actions.refresh.nonce\n      };\n      return $.post(wc_payment_gateway_token_editor.ajax_url, data).done((response) => {\n        if (!response.success) {\n          return handleError(editor, response.data);\n        }\n        if (response.data != null) {\n          editor.find('tr.no-tokens').hide();\n          return body.html(response.data);\n        } else {\n          body.empty();\n          return editor.find('tr.no-tokens').show();\n        }\n      }).fail((jqXHR, textStatus, error) => {\n        return handleError(editor, textStatus + ': ' + error);\n      }).always(() => {\n        return editor.unblock();\n      });\n    });\n    // Save the tokens\n    $('table.sv_wc_payment_gateway_token_editor').on('click', '.sv-wc-payment-gateway-token-editor-action-button[data-action=\"save\"]', function(e) {\n      var actions_row, editor, focused, inputs;\n      editor = $(this).closest('table');\n      actions_row = editor.find('tfoot th');\n      editor.block({\n        message: null,\n        overlayCSS: {\n          background: '#fff',\n          opacity: 0.6\n        }\n      });\n      actions_row.find('.error, .success').remove();\n      inputs = editor.find('tbody.tokens tr.token input[type=\"text\"]');\n      focused = false;\n      return inputs.each(function(index) {\n        var pattern, required, value;\n        $(this).removeClass('error');\n        value = $(this).val();\n        required = $(this).prop('required');\n        pattern = $(this).attr('pattern');\n        if (!(required || value)) {\n          return;\n        }\n        if (!value.match(pattern) || (required && !value)) {\n          e.preventDefault();\n          $(this).addClass('error');\n          if (!focused) {\n            actions_row.prepend('<span class=\"error\">' + wc_payment_gateway_token_editor.actions.save.error + '</span>');\n            $(this).focus();\n            focused = true;\n          }\n          return editor.unblock();\n        }\n      });\n    });\n    // Handles any AJAX errors.\n\n    // @since 5.1.0\n    return handleError = function(editor, error, message = '') {\n      console.error(error);\n      if (!message) {\n        message = wc_payment_gateway_token_editor.i18n.general_error;\n      }\n      return editor.find('th.actions').prepend('<span class=\"error\">' + message + '</span>');\n    };\n  });\n\n}).call(this);\n"]}