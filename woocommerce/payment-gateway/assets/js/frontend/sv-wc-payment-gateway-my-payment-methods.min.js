
/*
 WooCommerce SkyVerge Payment Gateway My Payment Methods CoffeeScript
 Version 5.1.0

 Copyright (c) 2014-2020, SkyVerge, Inc.
 Licensed under the GNU General Public License v3.0
 http://www.gnu.org/licenses/gpl-3.0.html
 */

(function() {
  var bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  jQuery(document).ready(function($) {
    "use strict";
    window.SV_WC_Payment_Methods_Handler_v5_8_1 = (function() {
      function SV_WC_Payment_Methods_Handler_v5_8_1(args) {
        this.cancel_edit = bind(this.cancel_edit, this);
        this.save_method = bind(this.save_method, this);
        this.edit_method = bind(this.edit_method, this);
        this.remove_duplicate_default_marks = bind(this.remove_duplicate_default_marks, this);
        this.replace_method_column = bind(this.replace_method_column, this);
        this.id = args.id;
        this.slug = args.slug;
        this.i18n = args.i18n;
        this.ajax_url = args.ajax_url;
        this.ajax_nonce = args.ajax_nonce;
        this.replace_method_column();
        this.remove_duplicate_default_marks();
        $(".woocommerce-MyAccount-paymentMethods").on('click', ".woocommerce-PaymentMethod--actions .button.edit", (function(_this) {
          return function(event) {
            return _this.edit_method(event);
          };
        })(this));
        $(".woocommerce-MyAccount-paymentMethods").on('click', ".woocommerce-PaymentMethod--actions .button.save", (function(_this) {
          return function(event) {
            return _this.save_method(event);
          };
        })(this));
        $(".woocommerce-MyAccount-paymentMethods").on('click', ".woocommerce-PaymentMethod--actions .cancel-edit", (function(_this) {
          return function(event) {
            return _this.cancel_edit(event);
          };
        })(this));
        $(".woocommerce-MyAccount-paymentMethods").on('click', ".woocommerce-PaymentMethod--actions .button.delete", (function(_this) {
          return function(event) {
            var button, row;
            button = $(event.currentTarget);
            row = button.parents('tr');
            if (row.find("input[name=plugin-id][value=" + _this.slug + "]").length === 0) {
              return;
            }
            if ($(event.currentTarget).hasClass('disabled') || !confirm(_this.i18n.delete_ays)) {
              return event.preventDefault();
            }
          };
        })(this));
        $('.button[href*="add-payment-method"]').click(function(event) {
          if ($(this).hasClass('disabled')) {
            return event.preventDefault();
          }
        });
      }

      SV_WC_Payment_Methods_Handler_v5_8_1.prototype.replace_method_column = function() {
        return $('.woocommerce-MyAccount-paymentMethods').find('tr').each((function(_this) {
          return function(index, element) {
            var titleColumn;
            if ($(element).find("input[name=plugin-id][value=" + _this.slug + "]").length === 0) {
              return;
            }
            $(element).find('th.woocommerce-PaymentMethod--title').remove();
            titleColumn = $(element).find('td.woocommerce-PaymentMethod--title');
            if (titleColumn.children().length > 0) {
              $(element).find('td.woocommerce-PaymentMethod--method').html(titleColumn.html());
            }
            return $(element).find('td.woocommerce-PaymentMethod--title').remove();
          };
        })(this));
      };

      SV_WC_Payment_Methods_Handler_v5_8_1.prototype.remove_duplicate_default_marks = function() {
        return $('.woocommerce-MyAccount-paymentMethods').find('tr').each((function(_this) {
          return function(index, element) {
            return $(element).find('td.woocommerce-PaymentMethod--default').find('mark.default:not(:first-child)').remove();
          };
        })(this));
      };

      SV_WC_Payment_Methods_Handler_v5_8_1.prototype.edit_method = function(event) {
        var button, row;
        event.preventDefault();
        button = $(event.currentTarget);
        row = button.parents('tr');
        if (row.find("input[name=plugin-id][value=" + this.slug + "]").length === 0) {
          return;
        }
        row.find('div.view').hide();
        row.find('div.edit').show();
        row.addClass('editing');
        button.text(this.i18n.cancel_button).removeClass('edit').addClass('cancel-edit').removeClass('button');
        return this.enable_editing_ui();
      };

      SV_WC_Payment_Methods_Handler_v5_8_1.prototype.save_method = function(event) {
        var button, data, row;
        event.preventDefault();
        button = $(event.currentTarget);
        row = button.parents('tr');
        if (row.find("input[name=plugin-id][value=" + this.slug + "]").length === 0) {
          return;
        }
        this.block_ui();
        row.next('.error').remove();
        data = {
          action: "wc_" + this.id + "_save_payment_method",
          nonce: this.ajax_nonce,
          token_id: row.find('input[name=token-id]').val(),
          data: row.find('input[name]').serialize()
        };
        return $.post(this.ajax_url, data).done((function(_this) {
          return function(response) {
            if (!response.success) {
              return _this.display_error(row, response.data);
            }
            if (response.data.title != null) {
              row.find('.woocommerce-PaymentMethod--method').html(response.data.title);
            }
            if (response.data.nonce != null) {
              _this.ajax_nonce = response.data.nonce;
            }
            button.siblings('.cancel-edit').removeClass('cancel-edit').addClass('edit').text(_this.i18n.edit_button).addClass('button');
            return _this.disable_editing_ui();
          };
        })(this)).fail((function(_this) {
          return function(jqXHR, textStatus, error) {
            return _this.display_error(row, error);
          };
        })(this)).always((function(_this) {
          return function() {
            return _this.unblock_ui();
          };
        })(this));
      };

      SV_WC_Payment_Methods_Handler_v5_8_1.prototype.cancel_edit = function(event) {
        var button, row;
        event.preventDefault();
        button = $(event.currentTarget);
        row = button.parents('tr');
        if (row.find("input[name=plugin-id][value=" + this.slug + "]").length === 0) {
          return;
        }
        row.find('div.view').show();
        row.find('div.edit').hide();
        row.removeClass('editing');
        button.removeClass('cancel-edit').addClass('edit').text(this.i18n.edit_button).addClass('button');
        return this.disable_editing_ui();
      };

      SV_WC_Payment_Methods_Handler_v5_8_1.prototype.enable_editing_ui = function() {
        $(".woocommerce-MyAccount-paymentMethods").addClass('editing');
        return $('.button[href*="add-payment-method"]').addClass('disabled');
      };

      SV_WC_Payment_Methods_Handler_v5_8_1.prototype.disable_editing_ui = function() {
        $(".woocommerce-MyAccount-paymentMethods").removeClass('editing');
        return $('.button[href*="add-payment-method"]').removeClass('disabled');
      };

      SV_WC_Payment_Methods_Handler_v5_8_1.prototype.block_ui = function() {
        return $(".woocommerce-MyAccount-paymentMethods").parent('div').block({
          message: null,
          overlayCSS: {
            background: '#fff',
            opacity: 0.6
          }
        });
      };

      SV_WC_Payment_Methods_Handler_v5_8_1.prototype.unblock_ui = function() {
        return $(".woocommerce-MyAccount-paymentMethods").parent('div').unblock();
      };

      SV_WC_Payment_Methods_Handler_v5_8_1.prototype.display_error = function(row, error, message) {
        var columns;
        if (message == null) {
          message = '';
        }
        console.error(error);
        if (!message) {
          message = this.i18n.save_error;
        }
        columns = $(".woocommerce-MyAccount-paymentMethods thead tr th").size();
        return $('<tr class="error"><td colspan="' + columns + '">' + message + '</td></tr>').insertAfter(row).find('td').delay(8000).slideUp(200);
      };

      return SV_WC_Payment_Methods_Handler_v5_8_1;

    })();
    return $(document.body).trigger('sv_wc_payment_methods_handler_v5_8_1_loaded');
  });

}).call(this);

//# sourceMappingURL=sv-wc-payment-gateway-my-payment-methods.min.js.map
